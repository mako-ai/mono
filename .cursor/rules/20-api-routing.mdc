---
globs: api/src/**/*.ts
description: API routing, middleware, and services conventions
---

# API Routing & Services

- Routes live under [api/src/routes/](mdc:api/src/routes/) and should export handlers; avoid business logic in route files.
- Shared logic should reside under [api/src/services/](mdc:api/src/services/).
- Auth middleware: see [api/src/auth/unified-auth.middleware.ts](mdc:api/src/auth/unified-auth.middleware.ts) and [api/src/auth/auth.middleware.ts](mdc:api/src/auth/auth.middleware.ts).
- Inngest handlers and jobs live under [api/src/inngest/](mdc:api/src/inngest/).
- Connectors are registered via [api/src/connectors](mdc:api/src/connectors) and [api/dist/connectors/registry.js](mdc:api/dist/connectors/registry.js) is generated output.

Rules:

- Validate inputs at the route boundary; prefer zod or schema validation if present.
- Return consistent error shapes; do not leak stack traces in responses.
- Keep route files minimal: parameter parsing, auth, and delegating to services.
